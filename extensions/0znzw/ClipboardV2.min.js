/**!
 * Clipboard
 * @author 0znzw <meow@miyo.lol> (@link https://scratch.mit.edu/users/0znzw/)
 * @version 1.0
 * @license MIT AND LGPL-3.0
 * Do not remove this comment
 * TurboWarp's: https://extensions.turbowarp.org/clipboard.js
 * This extension's code is not based on the source code of TurboWarp's.
 */
!function(t){"use strict";if(!t.extensions.unsandboxed)throw new Error('"Clipboard" extension must be ran unsandboxed.');const{BlockType:e,ArgumentType:r,Cast:a,vm:i}=t,{runtime:o}=i,s="clipboard",n=(t,e,...r)=>t?.[e]?.bind?.(t,...r),c=function(){const t={};return function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{t.base64js=e()}}((function(){return function t(e,r,a){function i(s,n){if(!r[s]){if(!e[s]){var c="function"==typeof require&&require;if(!n&&c)return c(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var d=r[s]={exports:{}};e[s][0].call(d.exports,(function(t){return i(e[s][1][t]||t)}),d,d.exports,t,e,r,a)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<a.length;s++)i(a[s]);return i}({"/":[function(t,e,r){function a(t){var e=t.length;if(0<e%4)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function i(t){return s[63&t>>18]+s[63&t>>12]+s[63&t>>6]+s[63&t]}function o(t,e,r){for(var a,o=[],s=e;s<r;s+=3)a=(16711680&t[s]<<16)+(65280&t[s+1]<<8)+(255&t[s+2]),o.push(i(a));return o.join("")}r.byteLength=function(t){var e=a(t),r=e[0],i=e[1];return 3*(r+i)/4-i},r.toByteArray=function(t){var e,r,i=a(t),o=i[0],s=i[1],l=new c(function(t,e,r){return 3*(e+r)/4-r}(0,o,s)),d=0,p=0<s?o-4:o;for(r=0;r<p;r+=4)e=n[t.charCodeAt(r)]<<18|n[t.charCodeAt(r+1)]<<12|n[t.charCodeAt(r+2)]<<6|n[t.charCodeAt(r+3)],l[d++]=255&e>>16,l[d++]=255&e>>8,l[d++]=255&e;return 2===s&&(e=n[t.charCodeAt(r)]<<2|n[t.charCodeAt(r+1)]>>4,l[d++]=255&e),1===s&&(e=n[t.charCodeAt(r)]<<10|n[t.charCodeAt(r+1)]<<4|n[t.charCodeAt(r+2)]>>2,l[d++]=255&e>>8,l[d++]=255&e),l},r.fromByteArray=function(t){for(var e,r=t.length,a=r%3,i=[],n=16383,c=0,l=r-a;c<l;c+=n)i.push(o(t,c,c+n>l?l:c+n));return 1===a?(e=t[r-1],i.push(s[e>>2]+s[63&e<<4]+"==")):2===a&&(e=(t[r-2]<<8)+t[r-1],i.push(s[e>>10]+s[63&e>>4]+s[63&e<<2]+"=")),i.join("")};for(var s=[],n=[],c="undefined"==typeof Uint8Array?Array:Uint8Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0;d<64;++d)s[d]=l[d],n[l.charCodeAt(d)]=d;n[45]=62,n[95]=63},{}]},{},[])("/")})),t.base64js}.apply({});t.extensions.register(o[`ext_${s}`]=new class{static exports={gbind:n,Base64:c};constructor(){this._clipboard=navigator.clipboard,this._readText=this._clipboard&&n(this._clipboard,"readText"),this._writeText=this._clipboard&&n(this._clipboard,"writeText"),this._lastPaste=null,this._history=[],this._lastFiles=[new Map,[]],window.addEventListener("copy",(()=>o.startHats(`${s}_whenCopied`))),window.addEventListener("cut",(()=>o.startHats(`${s}_whenCut`))),window.addEventListener("paste",(t=>{for(o.startHats(`${s}_whenPasted`),this._lastPaste=t.clipboardData||window.clipboardData,this._history.unshift(this.getPaste());this._history.length>10;)this._history.pop();this._lastFiles=[new Map,[]],Array.from(this._lastPaste.files).forEach((t=>{this._lastFiles[0].set(t.name,t),this._lastFiles[1].push(t.name)})),this._lastFiles[1].length>0&&o.startHats(`${s}_whenFilesPasted`)}))}getInfo(){return{id:s,name:"Clipboard V2",color1:"#008080",color2:"#006666",blocks:[{opcode:"whenCopied",blockType:e.EVENT,text:"when text copied",isEdgeActivated:!1},{opcode:"whenPasted",blockType:e.EVENT,text:"when text pasted",isEdgeActivated:!1},{opcode:"setClipboard",blockType:e.COMMAND,text:"copy [TEXT] to clipboard",arguments:{TEXT:{type:r.STRING,defaultValue:""}}},{opcode:"resetClipboard",blockType:e.COMMAND,text:"clear clipboard"},{opcode:"clipboard",blockType:e.REPORTER,text:"clipboard",disableMonitor:!0},{opcode:"getLastPastedText",blockType:e.REPORTER,text:"last text pasted",disableMonitor:!0},"---",{opcode:"whenFilesPasted",blockType:e.EVENT,text:"when file(s) pasted",isEdgeActivated:!1},{opcode:"whenCut",blockType:e.EVENT,text:"when text cut",isEdgeActivated:!1},{opcode:"clearPaste",blockType:e.COMMAND,text:"clear pasted data"},{opcode:"clearHistory",blockType:e.COMMAND,text:"clear paste history"},{opcode:"writeRaw",blockType:e.COMMAND,text:"write dataURL [DATA] to clipboard",arguments:{DATA:{type:r.STRING,defaultValue:"data:text/plain;,Hi"}}},{opcode:"canDoAction",blockType:e.BOOLEAN,text:"can [ACTION] clipboard?",arguments:{ACTION:{type:r.STRING,menu:"ACTION"}},disableMonitor:!0},{opcode:"getPasteFiles",blockType:e.REPORTER,text:"last pasted files",disableMonitor:!0},{opcode:"getPasteFileData",blockType:e.REPORTER,text:"get pasted file [NAME] as [TYPE]",arguments:{NAME:{type:r.STRING,defaultValue:"file name"},TYPE:{type:r.STRING,menu:"DATA_TYPE"}},disableMonitor:!0},{opcode:"getHistory",blockType:e.REPORTER,text:"paste history",disableMonitor:!0},{opcode:"canWriteType",blockType:e.BOOLEAN,text:"is type [TYPE] supported by clipboard?",arguments:{TYPE:{type:r.STRING,defaultValue:"text/plain"}},disableMonitor:!0}],menus:{ACTION:{acceptReporters:!0,items:["read","write"]},DATA_TYPE:{acceptReporters:!0,items:["text","base64",{text:"dataURL",value:"dataurl"},{text:"arrayBuffer",value:"arraybuffer"}]}}}}getPaste(t){return this._lastPaste?"ev"===t?this._lastPaste:this._lastPaste.getData(t??"text"):""}setClipboard({TEXT:t}){t=a.toString(t),this._writeText&&this._writeText(t);const e=document.activeElement||document.querySelector("*:focus"),r=document.createElement("input");r.value=t,r.style.top="0px",r.style.left="0px",r.style.position="fixed",document.body.appendChild(r),r.focus(),r.select();try{document.execCommand("copy")}catch{}r.blur(),document.body.removeChild(r),e&&e.focus()}resetClipboard(){this.setClipboard({TEXT:""})}async clipboard(){if(!this._readText)return"";return await t.canReadClipboard().catch((()=>!1))?this._readText()??"":""}getLastPastedText(){return this._history[0]}_promiseWrapper(t){return new Promise(((e,r)=>{let a=!1;return t(((...t)=>(a=!0,e(...t))),r).then(((...t)=>{if(!a)return e(...t)})).catch(r)}))}_getPasteFile(t){return this._lastFiles[0].get(t)??new File(new Uint8Array,"")}_getPasteFileObj(t){const e=this._getPasteFile(t);return{name:e.name||"",size:e.size||0,type:e.type||"",modified:e.lastModified||Date.now(),rpath:e.webkitRelativePath||""}}clearPaste(){this._lastPaste=null,this._lastFiles=[new Map,[]]}clearHistory(){this._history=[]}canDoAction({ACTION:e}){return"write"===(e="read"===a.toString(e).toLowerCase()?"read":"write")?!!this._writeText:this._promiseWrapper((async()=>await t.canReadClipboard().catch((()=>!1))&&!!this._readText))}getPasteFiles(){return JSON.stringify(this._lastFiles[1].map((t=>this._getPasteFileObj(t))))}getPasteFileData({NAME:t,TYPE:e}){e=a.toString(e).toLowerCase();const r=this._getPasteFile(a.toString(t));return""===r.name?"":new Promise(((t,a)=>{const i=new FileReader;switch(i.onload=()=>{if("arraybuffer"===e)return t(i.result);let r=String(i.result);return"text"===e||"dataurl"!==e&&(r=r.replace(/^data:(.*,)?/,""),r.length%4>0&&(r+="=".repeat(4-r.length%4))),t(r)},i.onerror=a,e){case"arraybuffer":i.readAsArrayBuffer(r);break;case"base64":case"dataurl":i.readAsDataURL(r);break;default:i.readAsText(r)}}))}getHistory(){return JSON.stringify(this._history)}canWriteType({TYPE:t}){return ClipboardItem.supports(a.toString(t))}async writeRaw({DATA:t}){if(!this._writeText)return;if(!(t=a.toString(t)).startsWith("data:"))return"";const e=t.match(/[^:]\w+\/[\w-+\d.]+(?=;|,)/)[0];if(this.canWriteType({TYPE:e}))try{t=await fetch(t),t=await t.arrayBuffer();const r=new Blob([t],{type:e});await navigator.clipboard.write([new ClipboardItem({[r.type]:r})])}catch{}}})}(Scratch);