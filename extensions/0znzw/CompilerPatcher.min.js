/**!
 * Compiler Injector
 * @author 0znzw <meow@miyo.icu> (@link https://scratch.mit.edu/users/0znzw/)
 * @version 1.6
 * @license MIT AND LGPL-3.0
 * Do not remove this comment
 * 
 * @todo Support Unsandboxed.
 */
!function(e){if(!e.extensions.unsandboxed)throw new Error('"Compiler Injector" extension must be ran unsandboxed!');const{vm:t,BlockType:n,ArgumentType:s}=e,{runtime:o}=t,i="0znzwCompilerPatching",c=i.toUpperCase(),r=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a="Non-variable was passed to asRef",d=(()=>{let e=!1;const n=t.exports,s={...n};if(r(n,"these_broke_before_and_will_break_again")||r(n,"i_will_not_ask_for_help_when_these_break")){const t=r(n,"these_broke_before_and_will_break_again")?n.these_broke_before_and_will_break_again():n.i_will_not_ask_for_help_when_these_break();return e=r(t,"IntermediateStackBlock"),{...s,...t,...t.JSGenerator.unstable_exports,JSGP:t.JSGenerator.prototype,STGP:t.ScriptTreeGenerator.prototype,taco:e}}if(r(n,"JSGenerator")&&r(n,"IRGenerator")&&r(n.IRGenerator,"exports")&&r(n.IRGenerator.exports,"ScriptTreeGenerator")){const e=n.JSGenerator,t=e.exports;return s.InputType={NUMBER:t.TYPE_NUMBER,STRING:t.TYPE_STRING,UNKNOWN:t.TYPE_UNKNOWN,BOOLEAN:t.TYPE_UNKNOWN},{...s,JSGenerator:e,...n.IRGenerator.exports,...n.JSGenerator.exports,JSGP:n.JSGenerator.prototype,STGP:n.IRGenerator.exports.ScriptTreeGenerator.prototype}}throw new Error("The VM is outdated please use a version with a compiler and compiler exports.")})();d.taco?d.asRaw=function(e){return'"'===(e=String(e))[0]&&'"'===e[e.length-1]?JSON.parse(e):e}:d.asRaw=function(e){return e instanceof d.ConstantInput||r(e,"constantValue")?e.constantValue:e.asUnknown()},d.asRef=function(e,t){if((d.taco||!(e instanceof d.VariableInput||r(e,"_value")))&&!(d.taco&&(e=String(e))&&e.startsWith("b")&&e.endsWith(".value")))return console.log(a),`('${a}')`;if(e._value)return d.asRaw(e._value);const n=(e=e?.source||e).slice(0,e.indexOf(".")),s=Object.entries(t._setupVariables).find(e=>e[1]===n)[0],i=s.startsWith("stage.variables")?o.getTargetForStage():t.target,c=s.slice(s.indexOf('["')+2,s.length-2);return i.variables[c]?.value},o.patchedOpcodes=new Map,o.patchPresets=new Map,o.MioFunctions=new Map,o.patchedOpcodes.setOpcode=function(e,t,n){o.patchedOpcodes.has(e)||this.set(e,{ontop:null,before:"",after:""}),o.patchedOpcodes.get(e)[t]=n}.bind(o.patchedOpcodes);const p=`__patches_${i}__`,u=(e,t)=>{if(!e[p]){e[p]={};for(const n in t){const s=e[n];e[p][n]=e[n],e[n]=s?function(...e){return t[n].call(this,(...e)=>s.call(this,...e),...e)}:function(...e){return t[n].call(this,()=>{},...e)}}}},{asRaw:l,asRef:h,STGP:_,JSGP:I,Frame:m}=d,f=function(e){let t=e?.inputs;return t||(t=e),Array.from(Object.entries(t).flatMap(t=>String(t[0]).startsWith("ARG")?[this.descendInputOfBlock(e,t[0])]:[])||[])};function E(e){return""}if(d.taco){const{InputType:e,IntermediateInput:t,IntermediateStackBlock:n,StackOpcode:s,InputOpcode:r}=d;r[`${c}_OPPATCH`]=`${i}.opPatch`,r[`${c}_NEWLINE`]=`${i}.newline`,r[`${c}_PATCH_REPORTER`]=`${i}.patchReporter`,r[`${c}_ALL_PATCHED`]=`${i}.allPatched`,r[`${c}_IS_PATCHED`]=`${i}.isPatched`,r[`${c}_USE_PRESET_REPORTER`]=`${i}.presetReporter`,r[`${c}_REF_VARIABLE`]=`${i}.refVariable`,r[`${c}_CALL_FN_REPORTER`]=`${i}.callFnReporter`,s[`${c}_OPPATCH`]=`${i}.opPatch`,s[`${c}_PATCH_COMMAND`]=`${i}.patchCommand`,s[`${c}_PATCH_CONDITIONAL`]=`${i}.patchWrapper`,s[`${c}_PATCH_OPCODE`]=`${i}.patchOpcode`,s[`${c}_UNPATCH_OPCODE`]=`${i}.unpatchOpcode`,s[`${c}_NEW_PRESET`]=`${i}.newPreset`,s[`${c}_USE_PRESET_COMMAND`]=`${i}.presetCommand`,s[`${c}_DEBUG_STATE`]=`${i}.debugState`,s[`${c}_NEW_FN`]=`${i}.newFn`,s[`${c}_CALL_FN_COMMAND`]=`${i}.callFnCommand`,u(_,{descendInput(n,s,...a){const d=o.patchedOpcodes.get(s.opcode);if(d)return new t(r[`${c}_OPPATCH`],e.ANY,{node:n(s,...a),patchedOpcode:d});switch(s.opcode){case`${i}_newline`:return new t(r[`${c}_NEWLINE`],e.ANY,{});case`${i}_patch_reporter`:return new t(r[`${c}_PATCH_REPORTER`],e.ANY,{args:f.call(this,s)});case`${i}_all_patched`:return new t(r[`${c}_ALL_PATCHED`],e.ANY,{});case`${i}_is_patched`:return new t(r[`${c}_IS_PATCHED`],e.ANY,{opcode:this.descendInputOfBlock(s,"OPCODE").toType(e.STRING)});case`${i}_use_preset_reporter`:return this.script.yields=!0,new t(r[`${c}_USE_PRESET_REPORTER`],e.ANY,{name:this.descendInputOfBlock(s,"NAME").toType(e.STRING)});case`${i}_ref_variable`:return new t(r[`${c}_REF_VARIABLE`],e.ANY,{var:this.descendInputOfBlock(s,"VAR")});case`${i}_call_fn_reporter`:return this.script.yields=!0,new t(r[`${c}_CALL_FN_REPORTER`],e.ANY,{name:this.descendInputOfBlock(s,"NAME0").toType(e.STRING),args:f.call(this,s)},!0);default:return n(s,...a)}},descendStackedBlock(t,r,...a){const d=o.patchedOpcodes.get(r.opcode);if(d)return new n(s[`${c}_OPPATCH`],{node:t(r,...a),patchedOpcode:d});switch(r.opcode){case`${i}_patch_command`:return new n(s[`${c}_PATCH_COMMAND`],{args:f.call(this,r)});case`${i}_patch_conditional`:return new n(s[`${c}_PATCH_CONDITIONAL`],{js1:this.descendInputOfBlock(r,"JSSTART"),stack:this.descendSubstack(r,"SUBSTACK"),js2:this.descendInputOfBlock(r,"JSEND")});case`${i}_patch_opcode`:return new n(s[`${c}_PATCH_OPCODE`],{opcode:this.descendInputOfBlock(r,"OPCODE").toType(e.STRING),position:this.descendInputOfBlock(r,"POS").toType(e.STRING),js:this.descendInputOfBlock(r,"JS")});case`${i}_unpatch_opcode`:return new n(s[`${c}_UNPATCH_OPCODE`],{opcode:this.descendInputOfBlock(r,"OPCODE").toType(e.STRING)});case`${i}_new_preset`:return new n(s[`${c}_NEW_PRESET`],{name:this.descendInputOfBlock(r,"NAME").toType(e.STRING),id:r.id});case`${i}_use_preset_command`:return this.script.yields=!0,new n(s[`${c}_USE_PRESET_COMMAND`],{name:this.descendInputOfBlock(r,"NAME").toType(e.STRING)});case`${i}_debug_state`:return new n(s[`${c}_DEBUG_STATE`],{});case`${i}_new_fn`:return this.script.yields=!0,new n(s[`${c}_NEW_FN`],{name:this.descendInputOfBlock(r,"NAME0").toType(e.STRING),stack:this.descendSubstack(r,Object.keys(r.inputs).find(e=>e.startsWith("SUBSTACK"))),args:f.call(this,r).map(t=>t.toType(e.STRING))});case`${i}_call_fn_command`:return this.script.yields=!0,new n(s[`${c}_CALL_FN_COMMAND`],{name:this.descendInputOfBlock(r,"NAME0").toType(e.STRING),args:f.call(this,r)});default:return t(r,...a)}}}),u(I,{descendInput(e,t,...n){const s=t.inputs;switch(t.opcode){case r[`${c}_NEWLINE`]:return"\n";case r[`${c}_OPPATCH`]:return`${s.patchedOpcode.before??""}\n  ${null!==s.patchedOpcode.ontop?s.patchedOpcode.ontop:this.descendInput(s.node)}\n  ${s.patchedOpcode.after??""}`;case r[`${c}_PATCH_REPORTER`]:return s.args.map(e=>l(this.descendInput(e))||"").join("")||"";case r[`${c}_ALL_PATCHED`]:return"(JSON.stringify(Array.from(runtime.patchedOpcodes.keys())))";case r[`${c}_IS_PATCHED`]:return`(runtime.patchedOpcodes.has(${this.descendInput(s.opcode)}))`;case r[`${c}_PRESET_REPORTER`]:return E.call(this,s.name);case r[`${c}_REF_VARIABLE`]:return h(this.descendInput(s.var),this);case r[`${c}_CALL_FN_REPORTER`]:return`(yield* ((runtime.MioFunctions.get(${this.descendInput(s.name)}) || function*(){})(${s.args.map(e=>this.descendInput(e)).join(",")||""})))`;default:return e(t,...n)}},descendStackedBlock(e,t,...n){const o=t.inputs;switch(t.opcode){case s[`${c}_OPPATCH`]:this.source+=o.patchedOpcode.before??"",o.patchedOpcode.ontop?this.source+=o.patchedOpcode.ontop:this.descendStackedBlock(o.node),this.source+=o.patchedOpcode.after??"";break;case s[`${c}_PATCH_COMMAND`]:this.source+=o.args.map(e=>l(this.descendInput(e))||"").join("")||"";break;case s[`${c}_PATCH_CONDITIONAL`]:this.source+=l(this.descendInput(o.js1))+"\n",this.descendStack(o.stack,new m(!1)),this.source+="\n"+l(this.descendInput(o.js2));break;case s[`${c}_PATCH_OPCODE`]:this.source+=`runtime.patchedOpcodes.setOpcode(${this.descendInput(o.opcode)}, ${this.descendInput(o.position)}, ${this.descendInput(o.js)});`;break;case s[`${c}_UNPATCH_OPCODE`]:this.source+=`runtime.patchedOpcodes.delete(${this.descendInput(o.opcode)});`;break;case s[`${c}_NEW_PRESET`]:this.source+=`runtime.patchPresets.set(${this.descendInput(o.name)}, "${o.id}");`;break;case s[`${c}_PRESET_COMMAND`]:this.source+=E.call(this,o.name);break;case s[`${c}_DEBUG_STATE`]:this.source+="console.log('Debug state over');\n";break;case s[`${c}_NEW_FN`]:{const e=this.source;this.source="",this.descendStack(o.stack,new m(!1));const t=this.source;this.source=e;const n=`\n${Object.entries(this._setupVariables).map(e=>`let ${e[1]} = ${e[0]};\n`).join("")}`;this.source+=`runtime.MioFunctions.set(${this.descendInput(o.name)}, function*(${o.args.flatMap(e=>((e=String(this.descendInput(e))).startsWith('"')&&e.endsWith('"')&&(e=JSON.parse(e)),/([A-Z])([a-zA-Z0-9$_]+)/gi.test(e)?[e]:[])).join(",")||""}) {${n}${t}\n});\n`;break}case s[`${c}_CALL_FN_COMMAND`]:this.source+=`yield* ((runtime.MioFunctions.get(${this.descendInput(o.name)}) || function*(){})(${o.args.map(e=>this.descendInput(e)).join(",")||""}));\n`;break;default:return e(t,...n)}}})}else{const{TypedInput:e,TYPE_UNKNOWN:t,TYPE_BOOLEAN:n,TYPE_STRING:s}=d;u(_,{descendInput(e,t,...n){const s=o.patchedOpcodes.get(t.opcode);if(s)return{kind:`${i}.opPatch`,node:e(t,...n),patchedOpcode:s};switch(t.opcode){case`${i}_newline`:return{kind:`${i}.newline`};case`${i}_patch_reporter`:return{kind:`${i}.patchReporter`,args:f.call(this,t)};case`${i}_all_patched`:return{kind:`${i}.allPatched`};case`${i}_is_patched`:return{kind:`${i}.isPatched`,opcode:this.descendInputOfBlock(t,"OPCODE")};case`${i}_use_preset_reporter`:return this.script.yields=!0,{kind:`${i}.presetReporter`,name:this.descendInputOfBlock(t,"NAME")};case`${i}_ref_variable`:return{kind:`${i}.refVariable`,var:this.descendInputOfBlock(t,"VAR")};case`${i}_call_fn_reporter`:return this.script.yields=!0,{kind:`${i}.callFnReporter`,name:this.descendInputOfBlock(t,"NAME0"),args:f.call(this,t)};default:return e(t,...n)}},descendStackedBlock(e,t,...n){const s=o.patchedOpcodes.get(t.opcode);if(s)return{kind:`${i}.opPatch`,node:e(t,...n),patchedOpcode:s};switch(t.opcode){case`${i}_patch_command`:return{kind:`${i}.patchCommand`,args:f.call(this,t)};case`${i}_patch_conditional`:return{kind:`${i}.patchWrapper`,js1:this.descendInputOfBlock(t,"JSSTART"),stack:this.descendSubstack(t,"SUBSTACK"),js2:this.descendInputOfBlock(t,"JSEND")};case`${i}_patch_opcode`:return{kind:`${i}.patchOpcode`,opcode:this.descendInputOfBlock(t,"OPCODE"),position:this.descendInputOfBlock(t,"POS"),js:this.descendInputOfBlock(t,"JS")};case`${i}_unpatch_opcode`:return{kind:`${i}.unpatchOpcode`,opcode:this.descendInputOfBlock(t,"OPCODE")};case`${i}_new_preset`:return{kind:`${i}.newPreset`,name:this.descendInputOfBlock(t,"NAME"),id:t.id};case`${i}_use_preset_command`:return this.script.yields=!0,{kind:`${i}.presetCommand`,name:this.descendInputOfBlock(t,"NAME")};case`${i}_debug_state`:return{kind:`${i}.debugState`};case`${i}_new_fn`:return this.script.yields=!0,{kind:`${i}.newFn`,name:this.descendInputOfBlock(t,"NAME0"),stack:this.descendSubstack(t,Object.keys(t.inputs).find(e=>e.startsWith("SUBSTACK"))),args:f.call(this,t)};case`${i}_call_fn_command`:return this.script.yields=!0,{kind:`${i}.callFnCommand`,name:this.descendInputOfBlock(t,"NAME0"),args:f.call(this,t)};default:return e(t,...n)}}}),u(I,{descendInput(o,c,...r){switch(c.kind){case`${i}.newline`:return new e("\n",t);case`${i}.opPatch`:return new e(`${c.patchedOpcode.before??""}\n  ${null!==c.patchedOpcode.ontop?c.patchedOpcode.ontop:this.descendInput(c.node).asUnknown()}\n  ${c.patchedOpcode.after??""}`,t);case`${i}.patchReporter`:return new e(c.args.map(e=>l(this.descendInput(e))||"").join("")||"",t);case`${i}.allPatched`:return new e("(JSON.stringify(Array.from(runtime.patchedOpcodes.keys())))",s);case`${i}.isPatched`:return new e(`(runtime.patchedOpcodes.has(${this.descendInput(c.opcode).asString()}))`,n);case`${i}.presetReporter`:return new e(E.call(this,c.name),t);case`${i}.refVariable`:return new e(h(this.descendInput(c.var),this),t);case`${i}.callFnReporter`:return new e(`(yield* ((runtime.MioFunctions.get(${this.descendInput(c.name).asString()}) || function*(){}))(${c.args.map(e=>this.descendInput(e).asSafe()).join(",")||""}))`,t);default:return o(c,...r)}},descendStackedBlock(e,t,...n){switch(t.kind){case`${i}.opPatch`:this.source+=t.patchedOpcode.before??"",t.patchedOpcode.ontop?this.source+=t.patchedOpcode.ontop:this.descendStackedBlock(t.node),this.source+=t.patchedOpcode.after??"";break;case`${i}.patchCommand`:this.source+=t.args.map(e=>l(this.descendInput(e))||"").join("")||"";break;case`${i}.patchWrapper`:this.source+=l(this.descendInput(t.js1))+"\n",this.descendStack(t.stack,new m(!1)),this.source+="\n"+l(this.descendInput(t.js2));break;case`${i}.patchOpcode`:this.source+=`runtime.patchedOpcodes.setOpcode(${this.descendInput(t.opcode).asString()}, ${this.descendInput(t.position).asString()}, ${this.descendInput(t.js).asString()});`;break;case`${i}.unpatchOpcode`:this.source+=`runtime.patchedOpcodes.delete(${this.descendInput(t.opcode).asString()});`;break;case`${i}.newPreset`:this.source+=`runtime.patchPresets.set(${this.descendInput(t.name).asString()}, "${t.id}");`;break;case`${i}.presetCommand`:this.source+=E.call(this,t.name);break;case`${i}.debugState`:this.source+="console.log('Debug state over');\n";break;case`${i}.newFn`:{const e=this.source;this.source="",this.descendStack(t.stack,new m(!1));const n=this.source;this.source=e;const s=`\n${Object.entries(this._setupVariables).map(e=>`let ${e[1]} = ${e[0]};\n`).join("")}`;this.source+=`runtime.MioFunctions.set(${this.descendInput(t.name).asString()}, function*(${t.args.flatMap(e=>((e=String(this.descendInput(e).asSafe())).startsWith('"')&&e.endsWith('"')&&(e=JSON.parse(e)),/([A-Z])([a-zA-Z0-9$_]+)/gi.test(e)?[e]:[])).join(",")||""}) {${s}${n}\n});\n`;break}case`${i}.callFnCommand`:this.source+=`yield* ((runtime.MioFunctions.get(${this.descendInput(t.name).asString()}) || function*(){})(${t.args.map(e=>this.descendInput(e).asSafe()).join(",")||""}));\n`;break;default:return e(t,...n)}}})}const T=o._convertBlockForScratchBlocks.bind(o);o._convertBlockForScratchBlocks=function(e,t){const n=T(e,t);return e.mutator&&(n.json.mutator=e.mutator),n},e.gui&&e.gui.getBlockly().then(t=>{const n=t.Extensions.ALL_;class s extends t.FieldImage{constructor(e,t,n,s,o,i,c){super(e,t,n,o,i),this._callback=s.bind(this),this.noPadding=c}init(){this.fieldGroup_||(super.init(),this.mouseDownWrapper_=t.bindEventWithChecks_(this.getSvgRoot(),"mousedown",this,this.onMouseDown_),this.getSvgRoot().style.cursor="pointer")}showEditor_(){this._callback&&this._callback()}getSize(){return this.size_.width||this.render_(),this.noPadding?new this.size_.constructor(Math.max(1,this.size_.width-t.BlockSvg.SEP_SPACE_X),this.size_.height):this.size_}EDITABLE=!0}t.FieldImageButton=s,n?.[`mio_${i}_extendable`]||t.Extensions.registerMutator(`mio_${i}_extendable`,{domToMutation(e){this.inputCount=Math.floor(Number(e.getAttribute("inputcount"))),this.inputCount=Math.min(Math.max(this.minInputs,this.inputCount),this.maxInputs),!isNaN(this.inputCount)&&Number.isFinite(this.inputCount)||(this.inputCount=this.minInputs),this.prevInputCount=this.inputCount,this.updateDisplay_(!0)},mutationToDom(){const e=document.createElement("mutation");return e.setAttribute("inputcount",this.inputCount.toString()),e},isExtendableInput(e){return e.name.startsWith("ARROW_")||this.extendableDefs.some(t=>e.name.startsWith(t.id))||this.extendableDefsStart.some(t=>e.name.startsWith(t.id))||this.extendableDefsEnd.some(t=>e.name.startsWith(t.id))},disconnectOldBlocks_(){const e={},t=this.extendableDefsEnd.length>0,n=this.extendableDefsStart.length>0,s=this.prevInputCount+(this.extendableDefsStart.length>0),o=Object.create(null);if(t)for(const e of this.extendableDefsEnd){const t=this.getInput(this.getExtendableInput(e.id,s));t&&t.connection&&(o[t.name]=e.id)}for(const t of this.inputList)if(t.connection&&this.isExtendableInput(t)){const s=t.connection.targetBlock(),i={shadow:t.connection.getShadowDom(),block:s};let c=t.name;o[c]&&(c=this.getExtendableInput(o[c],this.inputCount+n),e[c]&&(e["$UNUSED"+c]=e[c],delete e[c])),e[c]?e["$UNUSED"+c]=i:e[c]=i,t.connection.setShadowDom(null),s&&t.connection.disconnect()}return e},removeAllInputs_(){this.inputList=this.inputList.filter(e=>!(this.isExtendableInput(e)||e.type===t.DUMMY_INPUT&&this.clearLabels)||(e.dispose(),!1))},attachShadow_(e,n){if(!n.shadowType)return;let s;t.Events.disable();try{s=this.workspace.newBlock(n.shadowType),s.setFieldValue(n.shadowDefault,n.shadowField),s.setShadow(!0),this.isInsertionMarker()||(s.initSvg(),s.render(!1))}finally{t.Events.enable()}t.Events.isEnabled()&&t.Events.fire(new t.Events.BlockCreate(s)),s.outputConnection?s.outputConnection.connect(e.connection):s.previousConnection.connect(e.connection)},buildShadowDom_(e){const t=document.createElement("shadow");t.setAttribute("type",e.shadowType);const n=document.createElement("field",null);return n.setAttribute("name",e.shadowField),t.appendChild(n),t},populateArgument_(e,t,n,s){let o=null,i=null;if(e&&t in e){const n=e[t];o=n.block,i=n.shadow}if(e&&o){if(e[t]=null,o.outputConnection?o.outputConnection.connect(n.connection):o.previousConnection.connect(n.connection),s.shadowType){const e=i||this.buildShadowDom_(s);n.connection.setShadowDom(e)}}else this.attachShadow_(n,s)},cleanInputs(){const t=e.vm.editingTarget;if(!t)return;const n=this.isInFlyout?e.vm.runtime.flyoutBlocks:t.blocks,s=n.getBlock(this.id);if(!s)return;const o=new Set(this.inputList.map(e=>e?.name)),i=s.inputs;for(const e of Object.keys(i)){const t=i[e];o.has(e)||(n.deleteBlock(t.block),n.deleteBlock(t.shadow),delete i[e])}},getExtendableInput(e,t){let n=e;return"SUBSTACK"===e?(t+=1)>1&&(n+=t):n+=t,n},addInput_(e,n,s=null){const o=this.getExtendableInput(e.id,n),i=this.appendInput_(e.type,o);e.type===t.DUMMY_INPUT?i.appendField(e.check):(e.check&&i.setCheck(e.check),this.populateArgument_(s,o,i,e))},insertInput(){t.Events.setGroup(!0);const e=t.Xml.domToText(this.mutationToDom());this.inputCount++,this.updateDisplay_();const n=t.Xml.domToText(this.mutationToDom()),s=new t.Events.BlockChange(this,"mutation",null,e,n);t.Events.fire(s),t.Events.setGroup(!1)},deleteInput(){t.Events.setGroup(!0);const e=t.Xml.domToText(this.mutationToDom());this.inputCount--;const n=this.extendableDefsStart.length>0?1:0;for(const e of this.extendableDefs)this.removeInput(this.getExtendableInput(e.id,this.inputCount+n));this.updateDisplay_();const s=t.Xml.domToText(this.mutationToDom()),o=new t.Events.BlockChange(this,"mutation",null,e,s);t.Events.fire(o),t.Events.setGroup(!1),this.cleanInputs()},createAllInputs_(e){let t=0;if(this.extendableDefsStart.length>0){for(const n of this.extendableDefsStart)this.addInput_(n,t,e);t++}for(let n=0;n<this.inputCount;n++){for(const n of this.extendableDefs)this.addInput_(n,t,e);t++}return t},addArrowButtons_(){if(this.inputCount>this.minInputs){const e=this.appendDummyInput("ARROW_LEFT"),t=new s("data:image/svg+xml;base64,PHN2ZyBkYXRhLW5hbWU9IkxheWVyIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDEwIDEzIiB0cmFuc2Zvcm09InNjYWxlKC0xLCAxKSI+PHBhdGggZD0iTTMuNjUuMTQ1YTIuNDEgMi40MSAwIDAgMSAxLjcyLjcxbDMuOTIgMy45MmEyLjQ1IDIuNDUgMCAwIDEgMCAzLjQ1bC0zLjkyIDMuOTFhMi40MiAyLjQyIDAgMCAxLTEuNzIuNzIgMi40OCAyLjQ4IDAgMCAxLTEuNzMtLjcxYy0uMjQtLjI5LS43MS0uNzItLjcxLTUuNjUgMC00LjkzLjQ2LTUuMzkuNzEtNS42NGEyLjQ0IDIuNDQgMCAwIDEgMS43My0uNzF6IiBmaWxsPSIjMjMxZjIwIiBvcGFjaXR5PSIuMSIvPjxwYXRoIGQ9Ik04Ljk4NSA2LjUxYTEuNDMgMS40MyAwIDAgMS0uNDIgMWwtMy45MiAzLjk0YTEuNDQgMS40NCAwIDAgMS0yIDBjLS41Ni0uNTYtLjU2LTkuMzEgMC05Ljg3YTEuNDQgMS40NCAwIDAgMSAyIDBsMy45MiAzLjkyYTEuNDMgMS40MyAwIDAgMSAuNDIgMS4wMXoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=",16,32,function(){this.sourceBlock_.deleteInput()},"Remove input",!0,this.inputCount<this.maxInputs);e.appendField(t)}if(this.inputCount<this.maxInputs){const e=this.appendDummyInput("ARROW_RIGHT"),t=new s("data:image/svg+xml;base64,PHN2ZyBkYXRhLW5hbWU9IkxheWVyIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDEwIDEzIj48cGF0aCBkPSJNMy42NS4xNDVhMi40MSAyLjQxIDAgMCAxIDEuNzIuNzFsMy45MiAzLjkyYTIuNDUgMi40NSAwIDAgMSAwIDMuNDVsLTMuOTIgMy45MWEyLjQyIDIuNDIgMCAwIDEtMS43Mi43MiAyLjQ4IDIuNDggMCAwIDEtMS43My0uNzFjLS4yNC0uMjktLjcxLS43Mi0uNzEtNS42NSAwLTQuOTMuNDYtNS4zOS43MS01LjY0YTIuNDQgMi40NCAwIDAgMSAxLjczLS43MXoiIGZpbGw9IiMyMzFmMjAiIG9wYWNpdHk9Ii4xIi8+PHBhdGggZD0iTTguOTg1IDYuNTFhMS40MyAxLjQzIDAgMCAxLS40MiAxbC0zLjkyIDMuOTRhMS40NCAxLjQ0IDAgMCAxLTIgMGMtLjU2LS41Ni0uNTYtOS4zMSAwLTkuODdhMS40NCAxLjQ0IDAgMCAxIDIgMGwzLjkyIDMuOTJhMS40MyAxLjQzIDAgMCAxIC40MiAxLjAxeiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg==",16,32,function(){this.sourceBlock_.insertInput()},"Add Input",!0,!1);e.appendField(t)}},updateDisplay_(e){if(!this.isInsertionMarker()&&!e&&this.workspace?.currentGesture_?.isDraggingBlock_&&this.workspace?.currentGesture_?.targetBlock_.type===this.type)return;const n=this.rendered;this.isInFlyout&&t.Events.disable(),this.rendered=!1,this.extendableUpdatedDisplay=!0;const s=this.disconnectOldBlocks_();this.removeAllInputs_();let o=this.createAllInputs_(s);this.addArrowButtons_();for(const e of this.extendableDefsEnd)this.addInput_(e,o,s);t.ScratchBlocks.ProcedureUtils.deleteShadows_.call(this,s),this.prevInputCount=this.inputCount,this.rendered=n,n&&(this.initSvg(),this.render()),this.isInFlyout&&t.Events.enable()}},function(){this.extendableDefs=[],this.extendableDefsStart=[],this.extendableDefsEnd=[],this.inputCount=2,this.minInputs=1,this.maxInputs=1/0,this.clearLabels=!1,this.prevInputCount=this.inputCount});const o=t.BlockSvg.prototype.initSvg;t.BlockSvg.prototype.initSvg=function(){return this.getExtendableInput&&!this.extendableUpdatedDisplay&&this.updateDisplay_(),o.call(this)};const c=(e,t,n=null,s=void 0,o=void 0,i=void 0)=>({type:e,id:t,check:n,shadowType:s,shadowField:o,shadowDefault:i});n?.[`mio_${i}_extendable_string`]||t.Extensions.register(`mio_${i}_extendable_string`,function(){this.extendableDefs=[c(t.INPUT_VALUE,"ARG",null,"text","TEXT","")],this.minInputs=1,this.inputCount=1}),n?.[`mio_${i}_extendable_newfn`]||t.Extensions.register(`mio_${i}_extendable_newfn`,function(){this.extendableDefsStart=[c(t.INPUT_VALUE,"NAME",null,"text","TEXT",""),c(t.DUMMY_INPUT,"ARGS_WORD","arguments")],this.extendableDefs=[c(t.INPUT_VALUE,"ARG","String","text","TEXT","")],this.extendableDefsEnd=[c(t.NEXT_STATEMENT,"SUBSTACK",null)],this.minInputs=0,this.inputCount=0}),n?.[`mio_${i}_extendable_callfn`]||t.Extensions.register(`mio_${i}_extendable_callfn`,function(){this.extendableDefsStart=[c(t.INPUT_VALUE,"NAME",null,"text","TEXT",""),c(t.DUMMY_INPUT,"ARGS_WORD","with arguments:")],this.extendableDefs=[c(t.INPUT_VALUE,"ARG",null,"text","TEXT","")],this.minInputs=0,this.inputCount=0})}),e.extensions.register(new class{getInfo(){return{id:i,name:"Compiler Injector",blocks:[{blockType:n.BUTTON,text:o.debug?"Disable debug":"Enable debug",func:"DEBUG"},{blockType:n.COMMAND,opcode:"debug_state",text:"debug compiler state"},"---",{blockType:n.REPORTER,opcode:"newline",text:"newline",allowDropAnywhere:!0,disableMonitor:!0},{blockType:n.COMMAND,opcode:"patch_command",text:"inject js",mutator:`mio_${i}_extendable`,extensions:[`mio_${i}_extendable_string`],func:"interpreter_error"},{blockType:n.REPORTER,opcode:"patch_reporter",text:"inject js",allowDropAnywhere:!0,disableMonitor:!0,mutator:`mio_${i}_extendable`,extensions:[`mio_${i}_extendable_string`],func:"interpreter_error"},{blockType:n.CONDITIONAL,opcode:"patch_conditional",text:["inject js [JSSTART]","[JSEND]"],arguments:{JSSTART:{type:s.STRING,defaultValue:"if (1) {"},JSEND:{type:s.STRING,defaultValue:"};"}},branchCount:1,func:"interpreter_error"},"---",{blockType:n.REPORTER,opcode:"ref_variable",text:"inject variable [VAR]",arguments:{VAR:{type:null}},allowDropAnywhere:!0,func:"interpreter_error"},{blockType:n.COMMAND,opcode:"patch_opcode",text:"inject js [JS] [POS] opcode [OPCODE]",arguments:{OPCODE:{type:s.STRING,defaultValue:"motion_direction"},JS:{type:s.STRING,defaultValue:"alert(1);"},POS:{menu:"inject_type"}},func:"interpreter_error"},{blockType:n.COMMAND,opcode:"unpatch_opcode",text:"uninject opcode [OPCODE]",arguments:{OPCODE:{type:s.STRING,defaultValue:"motion_direction"}},func:"interpreter_error"},{blockType:n.REPORTER,opcode:"all_patched",text:"patched opcodes",disableMonitor:!0,func:"interpreter_error"},{blockType:n.BOOLEAN,opcode:"is_patched",text:"is [OPCODE] patched?",arguments:{OPCODE:{type:s.STRING,defaultValue:"motion_direction"}},func:"interpreter_error"},"---",{blockType:n.CONDITIONAL,opcode:"new_preset",text:"create preset [NAME] using",arguments:{NAME:{type:s.STRING,defaultValue:"my preset"}},hideFromPalette:!0,func:"interpreter_error"},{blockType:n.COMMAND,opcode:"use_preset_command",text:"inject preset [NAME]",arguments:{NAME:{type:s.STRING,defaultValue:"my preset"}},hideFromPalette:!0,func:"interpreter_error"},{blockType:n.REPORTER,opcode:"use_preset_reporter",text:"inject preset [NAME]",arguments:{NAME:{type:s.STRING,defaultValue:"my preset"}},allowDropAnywhere:!0,hideFromPalette:!0,func:"interpreter_error"},"---",{blockType:n.COMMAND,opcode:"new_fn",text:"new function",mutator:`mio_${i}_extendable`,extensions:[`mio_${i}_extendable_newfn`],func:"interpreter_error"},{blockType:n.COMMAND,opcode:"call_fn_command",text:"run function",mutator:`mio_${i}_extendable`,extensions:[`mio_${i}_extendable_callfn`],func:"interpreter_error"},{blockType:n.REPORTER,opcode:"call_fn_reporter",text:"run function",allowDropAnywhere:!0,disableMonitor:!0,mutator:`mio_${i}_extendable`,extensions:[`mio_${i}_extendable_callfn`],func:"interpreter_error"}],menus:{inject_type:{acceptReporters:!0,items:[{text:"overtop of",value:"ontop"},"before","after"]}}}}DEBUG(){o.debug=!o.debug,t.extensionManager.refreshBlocks(),console.log(o.debug?"Enabled compiler logs":"Disabled compiler logs")}debug_state(){console.log("Debug state over")}newline(){return"\n"}patch_command(){}patch_reporter(){}patch_conditional(){}ref_variable(){}patch_opcode(){}precompile(){}all_patched(){}is_patched(){}unpatch_opcode(){}new_preset(){}use_preset_command(){}use_preset_reporter(){}new_fn(){}call_fn_command(){}call_fn_reporter(){}interpreter_error(e,t){const n=t.thread.isCompiled?t.thread.peekStack():t.thread.peekStackFrame().op.id;let s="This block cannot be ran in the interpreter.";t.target.blocks.getBlock(n)||(s+="\nBeing in the flyout may also cause issues."),o.visualReport(n,t.thread.isCompiled?"How did we get here...":s)}})}(Scratch);