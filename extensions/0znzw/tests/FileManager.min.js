/**!
 * File Manager
 * @author 0znzw <meow@miyo.lol> (@link https://scratch.mit.edu/users/0znzw/)
 * @version 1.0
 * @license MIT AND LGPL-3.0
 * Do not remove this comment
 */
!function(e){const n="0znzwEditorFileManager";if(!e.extensions.unsandboxed)throw new Error(`"${n}" must be ran unsandboxed.`);const t=function(){const e={};return function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{e.base64js=n()}}((function(){return function e(n,t,i){function o(a,l){if(!t[a]){if(!n[a]){var s="function"==typeof require&&require;if(!l&&s)return s(a,!0);if(r)return r(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var c=t[a]={exports:{}};n[a][0].call(c.exports,(function(e){return o(n[a][1][e]||e)}),c,c.exports,e,n,t,i)}return t[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({"/":[function(e,n,t){"use strict";function i(e){var n=e.length;if(0<n%4)throw new Error("Invalid string. Length must be a multiple of 4");var t=e.indexOf("=");return-1===t&&(t=n),[t,t===n?0:4-t%4]}function o(e){return a[63&e>>18]+a[63&e>>12]+a[63&e>>6]+a[63&e]}function r(e,n,t){for(var i,r=[],a=n;a<t;a+=3)i=(16711680&e[a]<<16)+(65280&e[a+1]<<8)+(255&e[a+2]),r.push(o(i));return r.join("")}t.byteLength=function(e){var n=i(e),t=n[0],o=n[1];return 3*(t+o)/4-o},t.toByteArray=function(e){var n,t,o=i(e),r=o[0],a=o[1],d=new s(function(e,n,t){return 3*(n+t)/4-t}(0,r,a)),c=0,u=0<a?r-4:r;for(t=0;t<u;t+=4)n=l[e.charCodeAt(t)]<<18|l[e.charCodeAt(t+1)]<<12|l[e.charCodeAt(t+2)]<<6|l[e.charCodeAt(t+3)],d[c++]=255&n>>16,d[c++]=255&n>>8,d[c++]=255&n;return 2===a&&(n=l[e.charCodeAt(t)]<<2|l[e.charCodeAt(t+1)]>>4,d[c++]=255&n),1===a&&(n=l[e.charCodeAt(t)]<<10|l[e.charCodeAt(t+1)]<<4|l[e.charCodeAt(t+2)]>>2,d[c++]=255&n>>8,d[c++]=255&n),d},t.fromByteArray=function(e){for(var n,t=e.length,i=t%3,o=[],l=16383,s=0,d=t-i;s<d;s+=l)o.push(r(e,s,s+l>d?d:s+l));return 1===i?(n=e[t-1],o.push(a[n>>2]+a[63&n<<4]+"==")):2===i&&(n=(e[t-2]<<8)+e[t-1],o.push(a[n>>10]+a[63&n>>4]+a[63&n<<2]+"=")),o.join("")};for(var a=[],l=[],s="undefined"==typeof Uint8Array?Array:Uint8Array,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0;c<64;++c)a[c]=d[c],l[d.charCodeAt(c)]=c;l[45]=62,l[95]=63},{}]},{},[])("/")})),e.base64js}.apply({});let i;const{BlockType:o,ArgumentType:r,Cast:a}=e,l=e.vm.runtime;window.scaffolding&&"object"==typeof window.scaffolding||(async()=>{if(!e.gui)throw new Error(`"${n}" requires Scratch.gui`);const o=(()=>{let e=null;(()=>{if(e)return e;const n=Array.from(document.styleSheets).filter((e=>!(e.ownerNode.textContent.startsWith("/* DO NOT EDIT\n@todo This file is copied from GUI and should be pulled out into a shared library.")&&(e.ownerNode.textContent.includes("input_input-form")||e.ownerNode.textContent.includes("label_input-group_"))))).map((e=>{try{return[...e.cssRules]}catch(e){return[]}})).flat().map((e=>e.selectorText)).filter((e=>e)).map((e=>e.match(/(([\w-]+?)_([\w-]+)_([\w\d-]+))/g))).filter((e=>e)).flat();e=[...new Set(n)];const t=new MutationObserver((n=>{for(const i of n)for(const n of i.addedNodes)if("STYLE"===n.tagName)return e=null,void t.disconnect()}));t.observe(document.head,{childList:!0})})();let n=new Map;return t=>(n.has(t)||n.set(t,e.find((e=>e.includes(t)))),n.get(t))})();function r(e,n,...t){this.windowHref=URL.createObjectURL(new Blob([e],{type:"text/html"})),this.onWindowMessage=e=>n(this,e),this.window=window.open(this.windowHref,...t),window.addEventListener("message",this.onWindowMessage),this.window.onclose=()=>URL.revokeObjectURL(this.windowHref)}const a={src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik00Ljk4MTE2IDFIMTUuMDE5NkMxNi40MDQyIDEgMTcuNjE1OCAyLjIxMTU0IDE3LjYxNTggMy41OTYxNVYxMC44NjU0SDEzLjYzNUMxMS4zODUgMTAuODY1NCA5LjY1NDI0IDEyLjc2OTIgOS42NTQyNCAxNC44NDYyVjE4LjgyNjlINC45ODExNkMzLjU5NjU1IDE4LjgyNjkgMi4zODUwMSAxNy42MTU0IDIuMzg1MDEgMTYuMjMwOFYzLjU5NjE1QzIuMzg1MDEgMi4yMTE1NCAzLjU5NjU1IDEgNC45ODExNiAxWk02LjAxOTYzIDkuODI2OTJIOC43ODg4NkM5LjQ4MTE2IDkuODI2OTIgMTAuMDAwNCA5LjQ4MDc3IDEwLjAwMDQgOC43ODg0NkMxMC4wMDA0IDguMDk2MTUgOS40ODExNiA3Ljc1IDguOTYxOTMgNy43NUg2LjAxOTYzQzUuNTAwMzkgNy43NSA0Ljk4MTE2IDguMjY5MjMgNC45ODExNiA4Ljc4ODQ2QzQuOTgxMTYgOS4zMDc2OSA1LjUwMDM5IDkuODI2OTIgNi4wMTk2MyA5LjgyNjkyWk0xNC4xNTQyIDUuODQ2MTVINi4wMTk2M0M1LjMyNzMyIDUuODQ2MTUgNC45ODExNiA1LjMyNjkyIDQuOTgxMTYgNC44MDc2OUM0Ljk4MTE2IDQuMjg4NDYgNS41MDAzOSAzLjc2OTIzIDYuMDE5NjMgMy43NjkyM0gxNC4xNTQyQzE0LjY3MzUgMy43NjkyMyAxNS4xOTI3IDQuMjg4NDYgMTUuMTkyNyA0LjgwNzY5QzE1LjAxOTYgNS4zMjY5MiAxNC42NzM1IDUuODQ2MTUgMTQuMTU0MiA1Ljg0NjE1Wk0xNy40NDI3IDEyLjI1SDEzLjQ2MTlDMTIuMDc3MyAxMi4yNSAxMC44NjU4IDEzLjQ2MTUgMTAuODY1OCAxNS4wMTkyVjE5TDE3LjQ0MjcgMTIuMjVaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K",windowHTML:()=>`\n<!DOCTYPE html>\n<html>\n  <head>\n    <title>File Manager</title>\n  </head>\n  <body>\n    <main>\n      <h2>File Manager</h2>\n      <span>DONT REFRESH THIS PAGE!!!</span><br />\n      <div id="controls" style="display: none;"></div>\n      <div id="files"><pre>(Note if this does not disappear try pressing the "Manage Files" button again!)</pre><br /><span>Loading...</span></div>\n    </main>\n    <script>(async () => {\n      const controlBar = document.querySelector('div#controls');\n      const filesNode = document.querySelector('div#files');\n      const querys = Object.create(null);\n      function postQuery(name, json, callback) {\n        json = json || {};\n        json.fromManager = true;\n        json.queryRequest = name;\n        window.opener.postMessage(JSON.stringify(json), '${window.location.href}');\n        querys[name] = (queryData) => {\n          delete querys[name];\n          callback(queryData);\n        };\n      }\n      const postQueryAsync = (name, json) => new Promise(resolve => postQuery(name, json, resolve));\n      window.addEventListener('message', (ev) => {\n        ev = JSON.parse(ev.data);\n        if (querys[ev.queryResponse]) querys[ev.queryResponse](ev);\n      });\n      const selectFile = () => new Promise(resolve => {\n        const input = document.createElement('input');\n        input.type = 'file';\n        input.onchange = async (ev) => resolve(await Promise.all(Array.from(ev.target.files).map(async (file) => {\n          return { data: Array.from(new Uint8Array(await file.arrayBuffer())), name: file.name, mime: file.type };\n        })));\n        input.click();\n      });\n      let files = new Set();\n      (() => {\n        const deleteAll = document.createElement('button');\n        deleteAll.textContent = 'Delete All';\n        deleteAll.onclick = async () => {\n          if (!confirm('Are you sure you want to do this!!!\\nThis MAJOR operation cannot be undone!!!')) return;\n          controlBar.style.display = 'none';\n          filesNode.innerHTML = 'No files!';\n          files = new Set();\n          await postQueryAsync('deleteAll');\n          controlBar.style.display = 'block';\n        };\n        const createFile = document.createElement('button');\n        createFile.textContent = 'Upload File';\n        createFile.onclick = async () => {\n          controlBar.style.display = 'none';\n          const filesList = await selectFile();\n          if (!filesNode.querySelector('div.file')) filesNode.innerHTML = '';\n          for (const file of filesList) {\n            await postQueryAsync('createFile', file);\n            if (files.has(file.name)) file.name += \` \${Math.round(Math.random() * 10_000_000).toString(12)}\`;\n            filesNode.appendChild(await createFileNode(file.name));\n          }\n          controlBar.style.display = 'block';\n        };\n        controlBar.appendChild(createFile);\n        controlBar.appendChild(deleteAll);\n      })();\n      const createFileNode = async (fileName) => {\n        files.add(fileName);\n        const fileNode = document.createElement('div');\n        fileNode.meta = (await postQueryAsync('getFileMeta', { path: fileName })).meta;\n        fileNode.classList.add('file');\n        fileNode.dataset.path = fileName;\n        const fileButtons = document.createElement('span');\n        fileButtons.classList.add('filebuttons');\n        const deleteButton = document.createElement('button');\n        deleteButton.classList.add('filebutton');\n        deleteButton.textContent = 'X';\n        deleteButton.onclick = () => {\n          if (!confirm('Are you sure you want to do this?\\nThis cannot be undone.')) return;\n          fileNode.remove();\n          files.delete(fileName);\n          if (!filesNode.querySelector('div.file')) filesNode.innerHTML = 'No Files!';\n          postQueryAsync('deleteFile', { name: fileName });\n        };\n        fileButtons.appendChild(deleteButton);\n        const renameButton = document.createElement('button');\n        renameButton.classList.add('filebutton');\n        renameButton.textContent = 'rename';\n        renameButton.onclick = () => {\n          const newName = prompt('New file name:', fileName);\n          if (newName === fileName || newName === null) return;\n          if (files.has(newName)) return alert('A file with that name already exists!');\n          fileNode.querySelector('span.filename > span').textContent = newName;\n          files.delete(fileName);\n          files.add(newName);\n          postQueryAsync('renameFile', { name: fileName, newName });\n        };\n        fileButtons.appendChild(renameButton);\n        fileNode.appendChild(fileButtons);\n        fileNode.appendChild(document.createElement('br'));\n        const fileNameNode = document.createElement('span');\n        const fileNameHolder = document.createElement('span');\n        fileNameHolder.classList.add('filename');\n        fileNameHolder.appendChild(document.createTextNode('File name: '));\n        fileNameNode.textContent = fileName;\n        fileNameHolder.appendChild(fileNameNode);\n        fileNode.appendChild(fileNameHolder);\n        fileNode.appendChild(document.createElement('br'));\n        const fileSizeNode = document.createElement('span');\n        const fileSizeHolder = document.createElement('span');\n        fileSizeHolder.classList.add('filesize');\n        fileSizeHolder.appendChild(document.createTextNode('File size: '));\n        fileSizeNode.textContent = String(fileNode.meta.size / 1000) + 'KB';\n        fileSizeHolder.appendChild(fileSizeNode);\n        fileNode.appendChild(fileSizeHolder);\n        fileNode.appendChild(document.createElement('br'));\n        const fileTypeNode = document.createElement('span');\n        const fileTypeHolder = document.createElement('span');\n        fileTypeHolder.classList.add('filetype');\n        fileTypeHolder.appendChild(document.createTextNode('File type: '));\n        fileTypeNode.textContent = fileNode.meta.mime;\n        fileTypeHolder.appendChild(fileTypeNode);\n        fileNode.appendChild(fileTypeHolder);\n        fileNode.appendChild(document.createElement('br'));\n        return fileNode;\n      };\n      const redrawFiles = async (filesList) => {\n        controlBar.style.display = 'none';\n        filesNode.innerHTML = '';\n        const fileNodes = await Promise.all(filesList.map(fileName => {\n           if (files.has(fileName)) fileName += \` \${Math.round(Math.random() * 10_000_000).toString(12)}\`;\n           return createFileNode(fileName);\n        }));\n        for (const fileNode of fileNodes) filesNode.appendChild(fileNode);\n        if (!(0 in fileNodes)) fileNodes.innerHTML = '<span>No files!</span>';\n        controlBar.style.display = 'block';\n      };\n      redrawFiles((await postQueryAsync('getFileNames')).files);\n    })();<\/script>\n  </body>\n</html>\n        `,windowAttrs:[(e,n)=>{if((n=JSON.parse(n.data)).fromManager&&n.queryRequest)switch(n.queryRequest){case"getFileNames":e.window.postMessage(JSON.stringify({queryResponse:"getFileNames",files:Object.keys(i).map((e=>e.replace("file_","")))}),e.windowHref);break;case"getFileMeta":e.window.postMessage(JSON.stringify({queryResponse:"getFileMeta",meta:(i[n.path]||{meta:{}}).meta}),e.windowHref);break;case"deleteAll":for(const e of Object.keys(i))delete i[e.replace("file_","")];e.window.postMessage(JSON.stringify({queryResponse:"deleteAll",status:!0}),e.windowHref),l.extensionManager.refreshBlocks();break;case"deleteFile":e.window.postMessage(JSON.stringify({queryResponse:"deleteFile",status:delete i[n.name]}),e.windowHref),l.extensionManager.refreshBlocks();break;case"createFile":i[n.name]={data:t.fromByteArray(n.data),meta:{mime:n.mime,size:n.data.length}},e.window.postMessage(JSON.stringify({queryResponse:"createFile",status:!0}),e.windowHref),l.extensionManager.refreshBlocks();break;case"renameFile":{const t=i[n.name];delete i[n.name],i[n.newName]=t,e.window.postMessage(JSON.stringify({queryResponse:"renameFile",status:!0}),e.windowHref),l.extensionManager.refreshBlocks();break}}},"location=no,height=420,width=360,scrollbars=yes,status=no"],onclick:()=>new r(a.windowHTML(),...a.windowAttrs)},s=()=>{return(e=`div.${o("menu-bar_file-group")}`,new Promise(((o,r)=>{n=n||document,t=t||3e4,i=i||100,t=setTimeout((()=>{clearInterval(i),clearTimeout(t),r()}),t),i=setInterval((()=>{const r=n.querySelector(e);r&&(clearInterval(i),clearTimeout(t),o(r))}),i)}))).then((e=>{const n=e.querySelector(`div:not(.${o("menu-bar_active")}) ~ :not(:has(div.${o("menu-bar_menu-bar-menu")}))`).cloneNode(!0);n.querySelector("span > span").textContent="Manage Files",n.querySelector("img").src=a.src,n.onclick=a.onclick,e.appendChild(e.parentElement.querySelector("div[class*=divider_divider][class*=menu-bar_divider]").cloneNode(!0)),e.appendChild(n)}));var e,n,t,i};let d=ReduxStore.getState();ReduxStore.subscribe((e=>{const n=ReduxStore.getState();d.scratchGui.mode.isPlayerOnly!==n.scratchGui.mode.isPlayerOnly&&(d=n,s())})),await s()})();e.extensions.register(l[`ext_${n}`]=new class{constructor(){this.TextDecoder=new TextDecoder,i=new Proxy(l.extensionStorage[n]=l.extensionStorage[n]||{file_test:{data:"SGkh",meta:{mime:"text/plain",size:3}}},{set:(e,n,...t)=>(n=`file_${n}`,Reflect.set(e,n,...t)),get:(e,n,...t)=>(n=`file_${n}`,Reflect.get(e,n,...t)),deleteProperty:(e,n,...t)=>(n=`file_${n}`,Reflect.deleteProperty(e,n,...t))})}getInfo(){return{id:n,name:"Editor Files",blocks:[{blockType:o.BUTTON,func:"README",text:"README :3"},{blockType:o.REPORTER,opcode:"getFile",text:"get file [NAME] as [TYPE]",arguments:{NAME:{menu:"files"},TYPE:{menu:"types"}}},{blockType:o.REPORTER,opcode:"getAttr",text:"get file [NAME] [ATTR]",arguments:{NAME:{menu:"files"},ATTR:{menu:"attrs"}}}],menus:{files:{acceptReporters:!0,items:"_getFile"},types:{acceptReporters:!0,items:"_getType"},attrs:{acceptReporters:!0,items:"_getAttr"}}}}_getFile(e,n,t){if(void 0!==t)return i[t];const o=Object.keys(i).map((e=>e.replace("file_","")));return 0 in o||o.push(""),o}_getType(e,n,t){return void 0!==t?(["TEXT","DATAURL","BASE64","ARRAYBUFFER"].includes(t.toUpperCase())?t:"TEXT").toUpperCase():["text","dataURL","base64","arrayBuffer"]}_getAttr(e,n,t){return void 0!==t?(["SIZE","MIME"].includes(t.toUpperCase())?t:"SIZE").toUpperCase():["size","mime"]}getFile({NAME:e,TYPE:n}){if(!(e=this._getFile(null,null,a.toString(e))))return"";if("BASE64"===(n=this._getType(null,null,a.toString(n))))return e.data;if("DATAURL"===n)return`data:${e.meta.mime};base64,${e.data}`;const i=t.toByteArray(e.data);switch(n){case"TEXT":return this.TextDecoder.decode(i);case"ARRAYBUFFER":return i}}getAttr({NAME:e,ATTR:n}){return(e=this._getFile(null,null,a.toString(e)))?(n=this._getAttr(null,null,a.toString(n)),e.meta[n.toLowerCase()]??""):""}README(){alert('Use the "Manage Files" button in the navbar!!')}static exports={Base64:t}})}(Scratch);