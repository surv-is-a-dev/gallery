/**!
 * Break + Continue test
 * @author 0znzw <meow@miyo.lol> (@link https://scratch.mit.edu/users/0znzw/)
 * @version 1.1
 * @license MIT AND LGPL-3.0
 * Do not remove this comment
 */
!function(e){if(!e.extensions.unsandboxed)throw new Error('"Loop test" must be ran unsandboxed.');const{BlockType:t,ArgumentType:o,vm:n}=e;if(n.exports.i_will_not_ask_for_help_when_these_break){const e=n.exports.i_will_not_ask_for_help_when_these_break();if(!e.IntermediateStackedBlock){const{JSGenerator:t,ScriptTreeGenerator:o}=e,n=t.prototype,r=o.prototype,a=n.descendStackedBlock,s=r.descendStackedBlock;n.descendStackedBlock=function(...e){if(console.log(e),"0znzwBreakTest.break"===e[0].kind){if(!this.frames.find((e=>e.isLoop))?.isLoop)return null;this.source+="\nbreak;\n"}else{if("0znzwBreakTest.continue"!==e[0].kind)return a.apply(this,e);if(!this.frames.find((e=>e.isLoop))?.isLoop)return null;this.source+="\ncontinue;\n"}},r.descendStackedBlock=function(...e){return"0znzwBreakTest_break"===e[0].opcode?{kind:"0znzwBreakTest.break"}:"0znzwBreakTest_continue"===e[0].opcode?{kind:"0znzwBreakTest.continue"}:s.apply(this,e)}}}e.extensions.register(new class{getInfo(){return{id:"0znzwBreakTest",name:"Break + Continue!!",blocks:[{opcode:"break",blockType:t.COMMAND,text:"break (my legs)",isTerminal:!0},{opcode:"continue",blockType:t.COMMAND,text:"continue (your meds)",isTerminal:!0}]}}_getLoopFrame(e){const t=e.stackFrames;let o=null,n=-1;for(let e=t.length-1;e>=0&&!(e<0);e--)if(t[e].isLoop){o=t[e].op.id,n=e;break}return!!o&&[o,n]}break(e,t){const o=t.thread,n=o.peekStackFrame();if(!n._breakData){let e=!1;if(!(e=this._getLoopFrame(o)))return console.warn("Not in a loop!");const t=e[0],r=o.blockContainer.getBlock(t).next;n._breakData={loopFrameBlock:t,afterLoop:r}}const{loopFrameBlock:r,afterLoop:a}=n._breakData;for(;o.stack.at(-1)!==r;)o.popStack();o.popStack(),a&&o.pushStack(a)}continue(e,t){const o=t.thread,n=(o.blockContainer,o.peekStackFrame());if(!n._continueData){let e=!1;if(!(e=this._getLoopFrame(o)))return console.warn("Not in a loop!");n._continueData=e[0]}for(;o.stack[0]&&o.stack.at(-1)!==n._continueData;)o.popStack();o.status=o.constructor.STATUS_YIELD}})}(Scratch);